<div class="title-wrapper">
  <h2 class="section-title">
    @if (userRole === UserRole.PLAYER) {
      Mis reservas
    } @else {
      Reservas en tus espacios deportivos
    }
  </h2>
</div>

<div class="tab-buttons tab-buttons--reservation">
  <button [class.active]="activeTab() === 'personal'" (click)="setTab('personal')">Personal</button>
  <button [class.active]="activeTab() === 'community'" (click)="setTab('community')">Comunidad</button>
</div>

@if (activeTab() === 'community' && userRole === UserRole.PLAYER) {
  <div class="sub-tab-buttons">
    <button [class.active]="activeSubTab() === 'own'" (click)="setSubTab('own')">Creadas por mí</button>
    <button [class.active]="activeSubTab() === 'join'" (click)="setSubTab('join')">Salas unidas</button>
  </div>
}

@defer (prefetch on viewport) {
  @if (activeTab() === 'personal') {
    @if (reservations(); as reserv) {
      <div class="cards-grid">
        @for (res of reserv; track res.id) {
          <app-reservation-card [reservation]="res" />
        } @empty {
          @if (userRole === UserRole.PLAYER) {
            <div class="empty-state">
              <i class="lni lni-megaphone-1 empty-icon"></i>
              <p>No tienes reservas personales realizadas</p>
            </div>
          } @else if (this.userRole === UserRole.OWNER) {
            <div class="empty-state">
              <i class="lni lni-megaphone-1 empty-icon"></i>
              <p>Aún no se han realizado reservas personales en tus espacios deportivos</p>
            </div>
          }
        }
      </div>
    } @else {
      <div class="view-spinner view-spinner--sm">
        <app-spinner/>
      </div>
    }
  } @else if (activeTab() === 'community' && userRole === UserRole.OWNER) {
    @if (ownerRooms(); as rooms) {
      <div class="cards-grid">
        @for (room of rooms; track room.id) {
          <app-room-card [room]="room" [showStatus]="true"/>
        } @empty {
          <div class="empty-state">
            <i class="lni lni-megaphone-1 empty-icon"></i>
            <p>Aún no se han creado salas comunidad en tus espacios deportivos</p>
          </div>
        }
      </div>
    } @else {
      <div class="view-spinner view-spinner--sm">
        <app-spinner/>
      </div>
    }
  } @else if (activeTab() === 'community' && activeSubTab() === 'own' && userRole === UserRole.PLAYER) {
    @if (ownRooms(); as rooms) {
      <div class="cards-grid">
        @for (room of rooms; track room.id) {
          <app-room-card [room]="room" [showStatus]="true"/>
        } @empty {
          <div class="empty-state">
            <i class="lni lni-megaphone-1 empty-icon"></i>
            <p>No tienes salas comunidad creadas</p>
          </div>
        }
      </div>
    } @else {
      <div class="view-spinner view-spinner--sm">
        <app-spinner/>
      </div>
    }
  } @else if (activeTab() === 'community' && activeSubTab() === 'join' && userRole === UserRole.PLAYER) {
    @if (joinedRooms(); as rooms) {
      <div class="cards-grid">
        @for (room of rooms; track room.id) {
          <app-room-card [room]="room" [showStatus]="true"/>
        } @empty {
          <div class="empty-state">
            <i class="lni lni-megaphone-1 empty-icon"></i>
            <p>No te has unido a ninguna sala comunidad</p>
          </div>
        }
      </div>
    } @else {
      <div class="view-spinner view-spinner--sm">
        <app-spinner/>
      </div>
    }
  }
} @placeholder {
  <div class="empty-state">
    <i class="lni lni-hourglass placeholder-icon"></i>
    <p>Preparando carga de reservas...</p>
  </div>
} @loading {
  <div class="view-spinner view-spinner--sm">
    <app-spinner/>
  </div>
}

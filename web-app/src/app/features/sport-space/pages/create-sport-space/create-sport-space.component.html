<div class="title-wrapper">
  <h2 class="section-title">Crear Espacio Deportivo</h2>
</div>
<form class="form-body" [formGroup]="createSportSpaceForm" (ngSubmit)="createSportSpace()">
  <div class="form-grid">

    <!-- Fila 1: Nombre y Precio -->
    <div class="form-field">
      <input type="text" id="name" formControlName="name" placeholder=" " required />
      <label for="name">Nombre</label>
      <small class="error-text">
        @if (createSportSpaceForm.get('name')?.invalid && (createSportSpaceForm.get('name')?.dirty || createSportSpaceForm.get('name')?.touched)) {
          @if (createSportSpaceForm.get('name')?.errors?.['required']) {
            Debes ingresar un nombre
          }
          @if (createSportSpaceForm.get('name')?.errors?.['minlength']) {
            El nombre debe tener mínimo 7 caracteres
          }
        }
      </small>
    </div>
    <div class="form-field">
      <input type="number" id="price" formControlName="price" placeholder=" " required />
      <label for="price">Precio</label>
      <small class="error-text">
        @if (createSportSpaceForm.get('price')?.invalid && (createSportSpaceForm.get('price')?.dirty || createSportSpaceForm.get('price')?.touched)) {
          @if (createSportSpaceForm.get('price')?.errors?.['required']) {
            Debes ingresar un precio
          }
          @if (createSportSpaceForm.get('price')?.errors?.['min']) {
            El precio debe ser mayor o igual a 40
          }
        }
      </small>
    </div>

    <!-- Fila 2: Deporte y Modo de juego -->
    <div class="form-field">
      <select formControlName="sportId" required>
        @for (sport of SPORTS; track sport.id) {
          <option [value]="sport.id">{{ sport.label }}</option>
        }
      </select>
      <label>Deporte</label>
      <small class="error-text">
        @if (createSportSpaceForm.get('sportId')?.invalid && (createSportSpaceForm.get('sportId')?.dirty || createSportSpaceForm.get('sportId')?.touched)) {
          Debes seleccionar un deporte
        }
      </small>
    </div>
    <div class="form-field">
      <select formControlName="gamemodeId" required>
        @for (mode of gamemodes(); track mode.id) {
          <option [value]="mode.id">{{ mode.label }}</option>
        }
      </select>
      <label>Modo de juego</label>
      <small class="error-text">
        @if (createSportSpaceForm.get('gamemodeId')?.invalid && (createSportSpaceForm.get('gamemodeId')?.dirty || createSportSpaceForm.get('gamemodeId')?.touched)) {
          Debes seleccionar un modo de juego
        }
      </small>
    </div>

    <!-- Fila 3: Hora de apertura y cierre -->
    <div class="form-field">
      <select formControlName="openTime" required>
        @for (hour of [8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]; track hour) {
          <option [value]="hour.toString().padStart(2, '0') + ':00'">{{ hour.toString().padStart(2, '0') }}:00</option>
        }
      </select>
      <label>Hora de apertura</label>
      <small class="error-text">
        @if (createSportSpaceForm.get('openTime')?.invalid && (createSportSpaceForm.get('openTime')?.dirty || createSportSpaceForm.get('openTime')?.touched)) {
          Debes seleccionar una hora de apertura
        }
      </small>
    </div>
    <div class="form-field">
      <select formControlName="closeTime" required>
        @for (hour of [8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]; track hour) {
          <option [value]="hour.toString().padStart(2, '0') + ':00'">{{ hour.toString().padStart(2, '0') }}:00</option>
        }
      </select>
      <label>Hora de cierre</label>
      <small class="error-text">
        @if (createSportSpaceForm.get('closeTime')?.invalid && (createSportSpaceForm.get('closeTime')?.dirty || createSportSpaceForm.get('closeTime')?.touched)) {
          Debes seleccionar una hora de cierre
        }

        @if (createSportSpaceForm.errors?.['closeBeforeOpen']) {
          La hora de cierre debe ser mayor que la de apertura
        }

        @if (createSportSpaceForm.errors?.['lessThanFiveHours']) {
          Debe haber al menos 5 horas de diferencia
        }
      </small>
    </div>

    <!-- Fila 4: Descripción (ocupa las dos columnas) -->
    <div class="form-field form-field-full">
      <textarea formControlName="description" placeholder=" " required></textarea>
      <label>Información adicional</label>
      <small class="error-text">
        @if (createSportSpaceForm.get('description')?.invalid && (createSportSpaceForm.get('description')?.dirty || createSportSpaceForm.get('description')?.touched)) {
          @if (createSportSpaceForm.get('description')?.errors?.['required']) {
            Debes ingresar una descripción
          }
          @if (createSportSpaceForm.get('description')?.errors?.['minlength']) {
            La descripción debe tener mínimo 10 caracteres
          }
        }
      </small>
    </div>

    <!-- Fila 5: Mapa y Imagen -->
    <div>
      <div class="form-field">
        <input type="text" placeholder="Aquí aparecerá tu ubicación seleccionada en el mapa" [value]="selectedAddress" readonly />
        <label class="no-float-label">Dirección seleccionada</label>
        <small class="error-text"></small>
      </div>
      <div id="map" class="map-container" [ngClass]="{ 'invalid-map': locationNotSelected }"></div>
      <div class="form-field">
        <small class="error-text">
          @if (locationNotSelected) {
            Debes seleccionar una ubicación en el mapa
          }
        </small>
      </div>
    </div>
    <div>
      <div class="form-field">
        <input
          type="text"
          placeholder="Aquí aparecerá el nombre de tu imagen insertada"
          [value]="selectedImageFile?.name || ''"
          readonly
        />
        <label class="no-float-label">Nombre de la imagen</label>
        <small class="error-text"></small>
      </div>
      <div class="image-upload-area" [ngClass]="{ 'has-image': selectedImageUrl }">
        @if (selectedImageUrl) {
          <div class="image-preview">
            <img [src]="selectedImageUrl" alt="Vista previa de la imagen" />
          </div>
        } @else {
          <div class="image-placeholder">
            <span>De click acá para insertar su imagen</span>
          </div>
        }
        <input type="file" id="image" (change)="onImageSelected($event)" accept="image/*" required />
      </div>
      <div class="form-field">
        <small class="error-text">
          @if (submitted && !selectedImageUrl) {
            Debes seleccionar una imagen
          }
        </small>
      </div>
    </div>
  </div>

  <div class="button-center">
    <button class="button-submit"
            type="submit"
            [disabled]="isLoadingSubmitRequest()">
      @if (isLoadingSubmitRequest()) {
        <span class="spinner-default"></span>
      } @else {
        Crear
      }
    </button>
  </div>
</form>
